<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" content="text/html; charset=utf-8">
    <title>Test Site</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">

    <link href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css" rel="stylesheet" type="text/css">
    <link href="http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.5.min.css" rel="stylesheet" type="text/css">
    <script src="http://cdn.pydata.org/bokeh/release/bokeh-0.13.0.min.js"></script>
    <script src="http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.5.min.js"></script>

    <link rel="stylesheet" href="static/css/master.css">
  </head>
  <style type="text/css">

  div.tooltip {
   	position: absolute;
  	text-align: center;
  	padding: 2px;
  	color: rgb(9, 0, 135);
  	background: rgb(255, 255, 255, 0.5);
  	border: 0px;
  	border-radius: 8px;
  	pointer-events: none;
  }
  </style>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" id="nav_bar_bg">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="navbar-nav mr-auto ">
          <a class="nav-link text-white" href="{{ url_for('weather.current') }}">CURRENT</a>

          <a class="nav-link text-white" href="{{ url_for('weather.forecast') }}">Forecast</a>
          <a class="nav-link text-white" href="{{ url_for('weather.buoys') }}">Surf</a>
          <a class="nav-link text-white" href="{{ url_for('core.about') }}">About</a>
      </div>
      </div>
    </nav>

<div id="chart">

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script type="text/javascript">

			//Width and height
			var w = 960,
          h = 500,
          chartDiv = document.getElementById("chart");

      function redraw() {
        // Extract the width and height that was computed by CSS.
        var width = chartDiv.clientWidth;
        var height = chartDiv.clientHeight;

        // Use the extracted size to set the size of an SVG element.
        svg
          .attr("width", width)
          .attr("height", height);
      };

			//Define map projection
			var projection = d3.geoAlbersUsa();

			//Define path generator
			var path = d3.geoPath()
							 .projection(projection);

			//Create SVG element
			var svg = d3.select("#chart")
						.append("svg")
            .attr("viewBox", "0 0 960 500")
            .attr("preserveAspectRatio", "xMidYMid");

      // Append Div for tooltip to SVG
      var div = d3.select("#chart")
      		    .append("div")
          		.attr("class", "tooltip")
          		.style("opacity", 0);

      var userState = "Hawaii";
			//Load in GeoJSON data
			d3.json("static/us-states.json", function(json) {

          var state = json.features.filter(function(d) { return d.properties.name === userState; });

          projection.scale(1)
            .translate([0, 0]);

          var b = path.bounds(state[0]),
              s = 0.95 / Math.max((b[1][0] - b[0][0]) / w, (b[1][1] - b[0][1]) / h),
              t = [(w - s * (b[1][0] + b[0][0])) / 2, (h - s * (b[1][1] + b[0][1])) / 2];

          //Update projection with new offset
          projection
            .translate(t)
            .scale(s);

					//Bind data and create one path per GeoJSON feature
					svg.selectAll("path")
					   .data(state)
					   .enter()
					   .append("path")
					   .attr("d", path)
					   .style("fill", "rgb(100, 149, 237, 0.7)");

          d3.json("static/locations_details_v2.txt", function(txt) {

              var stations = txt.filter( function(txt) { return txt.state_full == userState})

              var station_details = [];
              stations.forEach( function(each) {
                station_details.push({"name": each.name, "coord": each.coord})
              });

              svg.selectAll("circle")
                  .data(station_details)
                  .enter()
                  .append("circle")
                  .attr("cx", function(d) {
                         return projection(d.coord)[0];
                       })
                  .attr("cy", function(d) {
                         return projection(d.coord)[1];
                       })
                  .attr("r", 1)
                  .style("fill", "rgb(214, 224, 24, 1.0)")
                  .style("stroke-width", "7")
                  .style("stroke", "rgb(214, 224, 24, 0.3)")

                  .on("click", function(d) {
                    div.transition()
                          .duration(200)
                          .style("opacity", .9);
                    div.text(d.name)
                          .style("left", (d3.event.pageX) + "px")
                          .style("top", (d3.event.pageY-28) + "px");
                  })
              });
				});
        redraw();

        window.addEventListener("resize", redraw);

		</script>
  </div>
</body>
</html>
